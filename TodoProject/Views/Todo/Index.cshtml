@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@model TodoProject.Models.TodoFilterViewModel
@using System.Globalization
@{
    ViewData["Title"] = @Localizer["PageTitle"];
    var userName = User.Identity?.Name ?? "Kullanıcı";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<link rel="stylesheet" href="~/css/todo.css" />



    <!-- Main Content -->
    <div class="main-content">
        <div class="container-fluid py-5">
            <!-- Başlık Alanı -->
            <div class="d-flex justify-content-between align-items-center mb-5">
                <h2 class="gradient-text fw-bold display-4">
                    <i class="fas fa-tasks me-3"></i>@Localizer["PageTitle"]
                </h2>
                <a href="/Todo/Create" class="btn btn-gradient btn-lg shadow px-4 py-3 fs-4">
                    <i class="fas fa-plus-circle me-2"></i>@Localizer["AddTaskButton"]
                </a>
            </div>

            <!-- Filtreleme ve Sıralama Formu -->
            <div class="card shadow-sm border-0 rounded-4 mb-5 filter-card">
                <div class="card-body">
                    <form method="get">
                        <div class="row g-4 align-items-end">
                            <div class="col-md-2">
                                <label asp-for="Status" class="form-label text-muted fs-5">
                                    <i class="fas fa-filter me-2"></i>@Localizer["Status"]
                                </label>
                                <select asp-for="Status" class="form-select fs-5 py-2">
                                    <option value="">@Localizer["ALL"]</option>
                                    <option value="I" selected="@(Model.Status == "I")">@Localizer["Status_IP"]</option>
                                    <option value="C" selected="@(Model.Status == "C")">@Localizer["Status_C"]</option>
                                    <option value="U" selected="@(Model.Status == "U")">@Localizer["Status_UC"]</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label asp-for="Priority" class="form-label text-muted fs-5">
                                    <i class="fas fa-bolt me-2"></i>@Localizer["Priority"]
                                </label>
                                <select asp-for="Priority" class="form-select fs-5 py-2">
                                    <option value="">@Localizer["ALL"]</option>
                                    <option value="Low" selected="@(Model.Priority == "Low")">@Localizer["Priority_Low"]</option>
                                    <option value="Medium" selected="@(Model.Priority == "Medium")">@Localizer["Priority_Medium"]</option>
                                    <option value="High" selected="@(Model.Priority == "High")">@Localizer["Priority_High"]</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label asp-for="Category" class="form-label text-muted fs-5">
                                    <i class="fas fa-tag me-2"></i>@Localizer["Category"]
                                </label>
                                <input asp-for="Category" class="form-control fs-5 py-2" placeholder="@Localizer["CategoryPlaceholder"]" />
                                <span asp-validation-for="Category" class="text-danger"></span>
                            </div>
                            <div class="col-md-3">
                                <label asp-for="SortBy" class="form-label text-muted fs-5">
                                    <i class="fas fa-sort me-2"></i>@Localizer["SortLabel"]
                                </label>
                                <select asp-for="SortBy" class="form-select fs-5 py-2">
                                    <option value="">@Localizer["Sort_Due_Desc"]</option>
                                    <option value="duedate_asc" selected="@(Model.SortBy == "duedate_asc")">@Localizer["Sort_Due_Asc"]</option>
                                    <option value="priority" selected="@(Model.SortBy == "priority")">@Localizer["Sort_Priority"]</option>
                                    <option value="title" selected="@(Model.SortBy == "title")">@Localizer["Sort_Title"]</option>
                                    <option value="status" selected="@(Model.SortBy == "status")">@Localizer["Sort_Status"]</option>
                                    <option value="category" selected="@(Model.SortBy == "category")">@Localizer["Sort_Category"]</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-primary w-100 btn-hover fs-5 py-2">
                                    <i class="fas fa-search me-2"></i>@Localizer["FilterButton"]
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            @if (!Model.Items.Any())
            {
                <div class="empty-state text-center py-5">
                    <i class="fas fa-clipboard-list fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted fs-3">@Localizer["NoTasksMessage"]</h4>
                </div>
            }
            else
            {
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
                    @foreach (var item in Model.Items)
                    {
                        <div class="col">
                            <div class="card h-100 border-0 rounded-4 shadow task-card bg-light-blue p-4">
                                <div class="card-body d-flex flex-column">
                                    <div class="d-flex justify-content-between mb-4">
                                        <h5 class="card-title fw-bold mb-0 fs-2">
                                            <i class="fas fa-thumbtack text-primary me-2"></i>
                                            @item.Title
                                        </h5>
                                        <div class="priority-badge">
                                            @switch (item.Priority)
                                            {
                                                case "Low":
                                                    <span class="badge bg-success fs-5 px-4 py-3">
                                                        <i class="fas fa-arrow-down me-1"></i>@Localizer["Priority_Low"]
                                                    </span>
                                                    break;
                                                case "Medium":
                                                    <span class="badge bg-warning text-dark fs-5 px-4 py-3">
                                                        <i class="fas fa-equals me-1"></i>@Localizer["Priority_Medium"]
                                                    </span>
                                                    break;
                                                case "High":
                                                    <span class="badge bg-danger fs-5 px-4 py-3">
                                                        <i class="fas fa-arrow-up me-1"></i>@Localizer["Priority_High"]
                                                    </span>
                                                    break;
                                            }
                                        </div>
                                    </div>

                                    <p class="card-text text-muted fs-4 mb-4">@item.Description</p>

                                    <div class="task-info mb-4">
                                        <div class="info-item fs-4 mb-3">
                                            <i class="fas fa-calendar text-info me-2"></i>
                                            @item.DueDate.ToString("dd MMMM yyyy HH:mm", CultureInfo.CurrentCulture)
                                        </div>
                                        <div class="info-item fs-4 mb-3">
                                            <i class="fas fa-tag text-success me-2"></i>
                                            @switch (item.Category)
                                            {
                                                case "School":
                                                    <span class="badge bg-primary fs-5 px-4 py-3">
                                                        <i class="fas fa-graduation-cap me-1"></i>@Localizer["Category_School"]
                                                    </span>
                                                    break;
                                                case "Work":
                                                    <span class="badge bg-secondary fs-5 px-4 py-3">
                                                        <i class="fas fa-briefcase me-1"></i>@Localizer["Category_Work"]
                                                    </span>
                                                    break;
                                                case "Sport":
                                                    <span class="badge bg-success fs-5 px-4 py-3">
                                                        <i class="fas fa-dumbbell me-1"></i>@Localizer["Category_Sport"]
                                                    </span>
                                                    break;
                                                default:
                                                    <span class="badge bg-light text-dark fs-5 px-4 py-3">@item.Category</span>
                                                    break;
                                            }
                                        </div>
                                        <div class="info-item fs-4">
                                            <i class="fas fa-info-circle text-warning me-2"></i>
                                            @switch (item.Status?.ToUpper())
                                            {
                                                case "U":
                                                    <span class="badge bg-warning text-dark fs-5 px-4 py-3">
                                                        <i class="fas fa-pause me-1"></i>@Localizer["Status_UC"]
                                                    </span>
                                                    break;
                                                case "I":
                                                    <span class="badge bg-info text-dark fs-5 px-4 py-3">
                                                        <i class="fas fa-play me-1"></i>@Localizer["Status_IP"]
                                                    </span>
                                                    break;
                                                case "C":
                                                    <span class="badge bg-success fs-5 px-4 py-3">
                                                        <i class="fas fa-check me-1"></i>@Localizer["Status_C"]
                                                    </span>
                                                    break;
                                                default:
                                                    <span class="badge bg-secondary fs-5 px-4 py-3">@Localizer["Unknown"]</span>
                                                    break;
                                            }
                                        </div>
                                    </div>

                                    <div class="action-buttons mt-auto pt-4 border-top">
                                        <div class="d-flex gap-3">
                                            <a href="/Todo/Edit/@item.Id" class="btn btn-outline-primary btn-lg flex-grow-1 fs-5 py-3">
                                                <i class="fas fa-edit me-1"></i>@Localizer["Edit"]
                                            </a>
                                            <form asp-action="Delete" asp-controller="Todo" method="post" onsubmit="return confirm('@(Localizer["DeleteConfirmMessage"])');" class="flex-grow-1">
                                                <input type="hidden" name="id" value="@item.Id" />
                                                <button type="submit" class="btn btn-outline-danger btn-lg w-100 fs-5 py-3">
                                                    <i class="fas fa-trash me-1"></i>@Localizer["Delete"]
                                                </button>
                                            </form>
                                        </div>
                                        <div class="d-flex gap-3 mt-3">
                                            <form asp-action="ChangeStatus" method="post" class="flex-grow-1">
                                                <input type="hidden" name="id" value="@item.Id" />
                                                <input type="hidden" name="newStatus" value="C" />
                                                <button type="submit" class="btn btn-outline-success btn-lg w-100 fs-5 py-3"
                                                        @(item.Status == "C" ? "disabled" : "")>
                                                    <i class="fas fa-check me-1"></i>@Localizer["MarkAsCompleted"]
                                                </button>
                                            </form>
                                            <form asp-action="ChangeStatus" method="post" class="flex-grow-1">
                                                <input type="hidden" name="id" value="@item.Id" />
                                                <input type="hidden" name="newStatus" value="U" />
                                                <button type="submit" class="btn btn-outline-warning btn-lg w-100 fs-5 py-3"
                                                        @(item.Status == "U" ? "disabled" : "")>
                                                    <i class="fas fa-undo me-1"></i>@Localizer["MarkAsUncompleted"]
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>


                                           
    </div>

                                      
</div>

<div id="note-container">
    <h5 class="mb-2">Notlar</h5>
    <form asp-action="SaveNote" method="post">
        <textarea id="note-text" name="noteText" placeholder="Buraya notunuzu yazın...">@ViewData["UserNote"]</textarea>

    <div class="mt-3 d-flex justify-content-between">
        <button id="save-note" type="submit" class="btn btn-primary">Kaydet</button>
        @*<button id="clear-note" type="submit" class="btn btn-danger">Temizle</button>*@
    </div>
    </form>
</div>

</div>

@section Scripts {


    @if (TempData["SuccessMessage"] != null)
    {
        <script>
            toastr["success"]("@Localizer["Toast_Success_Message"]", "@Localizer["Toast_Success_Title"]");
        </script>
    }

    @if (TempData["InfoMessage"] != null)
    {
        <script>
            toastr["info"]("@Localizer["Toast_Info_Message"]", "@Localizer["Toast_Info_Title"]");
        </script>
    }

    @if (TempData["WarningMessage"] != null)
    {
        <script>
            toastr["warning"]("@Localizer["Toast_Warning_Message"]", "@Localizer["Toast_Warning_Title"]");
        </script>
    }
 
    }