@model TodoProject.Entities.TodoItem
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@using System.Globalization

<div class="card h-100 border-0 rounded-4 shadow task-card bg-light-blue p-4 clickable-card"
     onclick="navigateToDetails(@Model.Id)" style="cursor: pointer;">
    <div class="card-body d-flex flex-column">
        <!-- Card Header - Title & Priority -->
        <div class="d-flex justify-content-between mb-4">
            <div class="title-container" style="flex: 1; margin-right: 15px;">
                <h5 class="card-title fw-bold mb-0 fs-2" style="line-height: 1.3; height: 80px; overflow: hidden;">
                    @{
                        string title = Model.Title ?? "";
                        string formattedTitle = "";

                        if (title.Length <= 12)
                        {
                            formattedTitle = "<i class='fas fa-thumbtack text-primary me-2'></i>" + title;
                        }
                        else if (title.Length <= 24)
                        {
                            formattedTitle = "<i class='fas fa-thumbtack text-primary me-2'></i>" + title.Substring(0, 12) + "<br/><span style='margin-left: 24px;'>" + title.Substring(12) + "</span>";
                        }
                        else
                        {
                            formattedTitle = "<i class='fas fa-thumbtack text-primary me-2'></i>" + title.Substring(0, 12) + "<br/><span style='margin-left: 24px;'>" + title.Substring(12, 12) + "...</span>";
                        }
                    }
                    @Html.Raw(formattedTitle)
                </h5>
            </div>
            <div class="priority-badge">
                @switch (Model.Priority)
                {
                    case "Low":
                        <span class="badge bg-success fs-5 px-4 py-3">
                            <i class="fas fa-arrow-down me-1"></i>@Localizer["Priority_Low"]
                        </span>
                        break;
                    case "Medium":
                        <span class="badge bg-warning text-dark fs-5 px-4 py-3">
                            <i class="fas fa-equals me-1"></i>@Localizer["Priority_Medium"]
                        </span>
                        break;
                    case "High":
                        <span class="badge bg-danger fs-5 px-4 py-3">
                            <i class="fas fa-arrow-up me-1"></i>@Localizer["Priority_High"]
                        </span>
                        break;
                }
            </div>
        </div>

        <!-- Description - 2 lines with word wrap -->
        <div class="description-container mb-4">
            <p class="card-text text-muted fs-4 mb-0">
                @{
                    string description = Model.Description ?? "";
                }
                @description
            </p>
        </div>

        <!-- Task Info -->
        <div class="task-info mb-4">
            <!-- Due Date -->
            <div class="info-item fs-4 mb-3">
                <i class="fas fa-calendar text-info me-2"></i>
                @Model.DueDate.ToString("dd MMMM yyyy HH:mm", CultureInfo.CurrentCulture)
            </div>

            <!-- Category -->
            <div class="info-item fs-4 mb-3">
                <i class="fas fa-tag text-success me-2"></i>
                @switch (Model.Category)
                {
                    case "School":
                        <span class="badge category-school fs-6 px-3 py-2">
                            <i class="fas fa-graduation-cap me-1"></i>@Localizer["Category_School"]
                        </span>
                        break;
                    case "Work":
                        <span class="badge category-work fs-6 px-3 py-2">
                            <i class="fas fa-briefcase me-1"></i>@Localizer["Category_Work"]
                        </span>
                        break;
                    case "Sport":
                        <span class="badge category-sport fs-6 px-3 py-2">
                            <i class="fas fa-dumbbell me-1"></i>@Localizer["Category_Sport"]
                        </span>
                        break;
                    default:
                        <span class="badge category-default fs-6 px-3 py-2">@Model.Category</span>
                        break;
                }
            </div>

            <!-- Status -->
            <div class="info-item fs-4">
                <i class="fas fa-info-circle text-warning me-2"></i>
                @switch (Model.Status?.ToUpper())
                {
                    case "U":
                        <span class="badge status-uncompleted fs-6 px-3 py-2">
                            <i class="fas fa-pause me-1"></i>@Localizer["Status_UC"]
                        </span>
                        break;
                    case "I":
                        <span class="badge status-inprogress fs-6 px-3 py-2">
                            <i class="fas fa-play me-1"></i>@Localizer["Status_IP"]
                        </span>
                        break;
                    case "C":
                        <span class="badge status-completed fs-6 px-3 py-2">
                            <i class="fas fa-check me-1"></i>@Localizer["Status_C"]
                        </span>
                        break;
                    default:
                        <span class="badge status-unknown fs-6 px-3 py-2">@Localizer["Unknown"]</span>
                        break;
                }
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons mt-auto pt-4 border-top">
            <!-- Edit & Delete Buttons -->
            <div class="d-flex gap-3">
                <a href="/Todo/Edit/@Model.Id" class="btn btn-task-edit btn-lg flex-grow-1 fs-5 py-1">
                    <i class="fas fa-edit me-1"></i>@Localizer["Edit"]
                </a>
                <form asp-action="Delete" asp-controller="Todo" method="post"
                      onsubmit="return confirm('@(Localizer["DeleteConfirmMessage"])');" class="flex-grow-1">
                    <input type="hidden" name="id" value="@Model.Id" />
                    <button type="submit" class="btn btn-task-delete btn-lg w-100 fs-5 py-2">
                        <i class="fas fa-trash me-1"></i>@Localizer["Delete"]
                    </button>
                </form>
            </div>
            <!-- Status Change Buttons -->
            <div class="d-flex gap-3 mt-3">
                <form asp-action="ChangeStatus" method="post" class="flex-grow-1">
                    <input type="hidden" name="id" value="@Model.Id" />
                    <input type="hidden" name="newStatus" value="C" />
                    <button type="submit" class="btn btn-task-complete btn-lg w-100 fs-5 py-2"
                            @(Model.Status == "C" ? "disabled" : "")>
                        <i class="fas fa-check me-1"></i>@Localizer["MarkAsCompleted"]
                    </button>
                </form>
                <form asp-action="ChangeStatus" method="post" class="flex-grow-1">
                    <input type="hidden" name="id" value="@Model.Id" />
                    <input type="hidden" name="newStatus" value="U" />
                    <button type="submit" class="btn btn-task-uncomplete btn-lg w-100 fs-5 py-2"
                            @(Model.Status == "U" ? "disabled" : "")>
                        <i class="fas fa-undo me-1"></i>@Localizer["MarkAsUncompleted"]
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>